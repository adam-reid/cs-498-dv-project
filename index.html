<!DOCTYPE html>
<html lang="en-US">
    <head>
        <title>CS-498 D3 Transitions Example</title>

        <meta charset="utf-8" />
        <meta name="author" content="Adam Reid" />
        <meta name="description" content="CS-498 D3 Week 7-3-3 Assignment" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <style> .chart rect { fill: steelblue } </style>
    </head>

    <body  onload='init()'>
        <header class="container">
            <h1 class="col-md-10"> <em>CS-498 Data Visualization - Narrative Visualization</em></h1>
            <h2 class="col-md-10">Distribution of Transportation Fatalities by Mode</h2>
            <h3 class="col-md-10">By: Adam Reid</h3>
        </header>
        <hr/>

        <main role="main" class="container">
            <section class="col-md-10" style="float: left">
                <p>This is where the text will go. 
                This is where the text will go. 
                This is where the text will go. 
                This is where the text will go. 
                This is where the text will go. 
                This is where the text will go. 
                This is where the text will go. 
                <span id="data"></span></p>
                <p>
                <nav align="center">
                  <a href="/html/">Previous</a> |
                  <a href="/css/">Home</a> |
                  <a href="/js/">Next</a>                  
                </nav>
                </p>                
            </section>

            <section class="col-md-10" style="float: right">
            <p>section 2</p>
            <svg class="chart" width=500 height=500></svg>
            </section>
        </main>

        <footer class="col-md-8">
        footer
        </footer>

        <script>
            var height = 400;
            var width = 400;
            var margin = 50;

            var svg = d3.select("svg").append("g").attr("transform", "translate(" + margin + "," + margin + ")");
            var tick_format = d3.format("~s");

            async function init() { // Allow for loading
                var data = await d3.csv("https://adam-reid.github.io/cs-498-dv-project/data.csv", function(d) {
                    return {
                         "x": +d.x,
                         "y": +d.y
                     }
                }).then(function(data) {
                    var xdomain = [0, 1, 2, 3, 4, 5]
                    var ydomain = [0, d3.max([1,2,42])]

                    var xrange = [0, width];
                    var yrange = [height, 0];

                    console.log("Keys: " + Object.keys(data));
                    console.log("Values: " + Object.values(data));

                    var xscale = d3.scaleBand().domain(xdomain).range(xrange);
                    var yscale = d3.scaleLinear().domain(ydomain).range(yrange);

                    d3.select("svg")
                        .append("g")
                        .attr("transform", "translate("+margin+","+margin+")")
                        .call(d3.axisLeft(yscale).tickFormat(tick_format));

                    d3.select("svg")
                        .append("g")
                        .attr("transform", "translate("+margin+","+(height+margin)+")")
                        .call(d3.axisBottom(xscale).tickFormat(tick_format));

                    d3.select(".chart")
                        .selectAll("rect")
                        .data(data)
                        .enter().append("rect")
                        .attr("width", xscale.bandwidth)
                        .attr("x", function(d, i) { return margin + xscale(i); })
                        .attr("y", height + margin)
                        .transition().duration(3000).delay(1000)
                        .attr("height", function(d, i) {return height - yscale(d.y); })
                        .attr("y", function(d) { return margin + yscale(d.y); });
                }).catch(function(error, rows) {
                    console.log("An error occurred.");
                });            
            }
        </script>
    </body>
</html>
